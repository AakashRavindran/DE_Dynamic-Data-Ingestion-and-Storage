# Below commands were run to load the data into Hive and then copy a partition to the second table for better performance during analysis

use guviHive;                                                                                                                                                                                                      
                                                                                                                                                                                                                   
load data local inpath "/root/hive_project/SUB-EST2020_ALL.csv" INTO TABLE guviHive.pop_estimate_us_2010_2020;                                                                                                     
                                                                                                                                                                                                                   
-- Set the partition state dynamically                                                                                                                                                                             
                                                                                                                                                                                                                   
SET STATE_VALUE=${hiveconf:state_value};                                                                                                                                                                           
                                                                                                                                                                                                                   
                                                                                                                                                                                                                   
                                                                                                                                                                                                                   
-- Insert data into the partitioned table using the dynamic state value                                                                                                                                            
                                                                                                                                                                                                                   
INSERT INTO TABLE partitioned_pop_estimate_us_2010_2020 PARTITION (STATE=${hiveconf:state_value})                                                                                                                  
                                                                                                                                                                                                                   
SELECT                                                                                                                                                                                                             
                                                                                                                                                                                                                   
    SUMLEV,                                                                                                                                                                                                        
                                                                                                                                                                                                                   
    COUNTY,                                                                                                                                                                                                        
                                                                                                                                                                                                                   
    PLACE,                                                                                                                                                                                                         
                                                                                                                                                                                                                   
    COUSUB,                                                                                                                                                                                                        
                                                                                                                                                                                                                   
    CONCIT,                                                                                                                                                                                                        
                                                                                                                                                                                                                   
    PRIMGEO_FLAG,                                                                                                                                                                                                  
                                                                                                                                                                                                                   
    FUNCSTAT,                                                                                                                                                                                                      
                                                                                                                                                                                                                   
    NAME,                                                                                                                                                                                                          
                                                                                                                                                                                                                   
    STNAME,                                                                                                                                                                                                        
                                                                                                                                                                                                                   
    CENSUS2010POP,                                                                                                                                                                                                 
                                                                                                                                                                                                                   
    ESTIMATESBASE2010,                                                                                                                                                                                             
                                                                                                                                                                                                                   
    POPESTIMATE2010,                                                                                                                                                                                               
                                                                                                                                                                                                                   
    POPESTIMATE2011,                                                                                                                                                                                               
                                                                                                                                                                                                                   
    POPESTIMATE2012,                                                                                                                                                                                               
                                                                                                                                                                                                                   
    POPESTIMATE2013,                                                                                                                                                                                               
                                                                                                                                                                                                                   
    POPESTIMATE2014,                                                                                                                                                                                               
                                                                                                                                                                                                                   
    POPESTIMATE2015,                                                                                                                                                                                               
                                                                                                                                                                                                                   
    POPESTIMATE2016,                                                                                                                                                                                               
                                                                                                                                                                                                                   
    POPESTIMATE2017,                                                                                                                                                                                               
                                                                                                                                                                                                                   
    POPESTIMATE2018,                                                                                                                                                                                               
                                                                                                                                                                                                                   
    POPESTIMATE2019,                                                                                                                                                                                               
                                                                                                                                                                                                                   
    POPESTIMATE042020,                                                                                                                                                                                             
                                                                                                                                                                                                                   
    POPESTIMATE2020                                                                                                                                                                                                
                                                                                                                                                                                                                   
FROM pop_estimate_us_2010_2020                                                                                                                                                                                     
                                                                                                                                                                                                                   
WHERE STATE = ${hiveconf:state_value};  
